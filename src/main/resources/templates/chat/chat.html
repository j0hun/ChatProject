<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>채팅방</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <link th:href="@{/css/chat.css}" rel="stylesheet"/>
</head>
<div layout:fragment="content">
    <div class="container" id="container">
        <h1 id="title_room">채팅방제목</h1>
        <div id="chatting" class="chatting"></div>
        <input type="hidden" id="userId" th:value="${member != null ? member.name : '익명'}" />
        <input type="hidden" id="roomId" th:value="${roomId}" />
        <div id="yourMsg">
            <table class="inputTable">
                <tr>
                    <th>메시지</th>
                    <th><input id="msg" placeholder="보내실 메시지를 입력하세요."></th>
                    <th>
                        <button onclick="send()" id="sendBtn">보내기</button>
                    </th>
                </tr>
            </table>
        </div>
    </div>
<!--    <script th:inline="javascript">-->

<!--        var userId = [[${member.name}]];-->

<!--        var roomId = [[${roomId}]];-->

<!--        function connect() {-->
<!--            //WebSocketConfig.java에 설정된 endpoint로 SockJS 객체, StompClient 객체 생성-->
<!--            var socket = new SockJS("/ws");-->
<!--            //do Handshake-->
<!--            stompClient = Stomp.over(socket);-->

<!--            // connect(header,연결 성공시 콜백,에러발생시 콜백)-->
<!--            stompClient.connect({}, function () {-->
<!--                    //subscribe(subscribe url,해당 url로 메시지를 받을때마다 실행할 함수)-->
<!--                    stompClient.subscribe('/sub/' + roomId, function (e) {-->
<!--                        //e.body에 전송된 data가 들어있다-->
<!--                        console.log(e);-->
<!--                        showMessage(JSON.parse(e.body));-->
<!--                    });-->
<!--                },-->
<!--                function (e) {-->
<!--                    //에러 콜백-->
<!--                    alert('에러발생');-->
<!--                }-->
<!--            );-->

<!--        }-->

<!--        connect();-->

<!--        // 화면에 메시지를 표시하는 함수-->
<!--        function showMessage(data) {-->
<!--            if (data.name === userId) {-->
<!--                $('#chatting').append("<p class='me'>" + data.name + " : " + data.content + "</p>");-->
<!--            } else {-->
<!--                $('#chatting').append("<p class='other'>" + data.name + " : " + data.content + "</p>");-->
<!--            }-->
<!--        }-->


<!--        //메시지 브로커로 메시지 전송-->
<!--        function send() {-->
<!--            var data = {-->
<!--                "name": userId,-->
<!--                "content": $("#msg").val()-->
<!--            };-->
<!--            // send(destination,헤더,페이로드)-->
<!--            stompClient.send("/pub/" + roomId, {}, JSON.stringify(data));-->
<!--            $("#msg").val('');-->
<!--        }-->

<!--    </script>-->
    <script src="/js/chat.js"></script>
</div>
</html>
